---
name: 1 - Pull Requests

on:
  pull_request:

concurrency:
  group: '${{ github.workflow }} @ ${{ github.event.pull_request.head.label || github.head_ref || github.ref }}'
  cancel-in-progress: true

jobs:

  unit-tests-daemon:
    uses: ./.github/workflows/unit-tests-workflow.yaml
    with:
      profile: Daemon

  unit-tests-libp2p:
    uses: ./.github/workflows/unit-tests-workflow.yaml
    with:
      profile: Libp2p

  unit-tests-archive:
    uses: ./.github/workflows/unit-tests-workflow.yaml
    with:
      profile: Archive

  unit-tests-rosetta:
    uses: ./.github/workflows/unit-tests-workflow.yaml
    with:
      profile: Rosetta

  build-libp2p-helper:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    needs:
      - unit-tests-libp2p
    with:
      profile: Libp2p Helper

  build-mina-daemon-light:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    needs:
      - unit-tests-daemon
      - build-libp2p-helper
    with:
      profile: Mina Daemon Light

  build-mina-archive:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    needs:
      - unit-tests-archive
    with:
      profile: Mina Archive

  build-integration-tests-daemon:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    with:
      profile: Integration Tests Daemon

  build-integration-tests-archive:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    with:
      profile: Integration Tests Archive

  build-integration-tests-rosetta:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    with:
      profile: Integration Tests Rosetta

  build-mina-rosetta:
    uses: ./.github/workflows/ocaml-compiler-workflow.yaml
    needs:
      - unit-tests-rosetta
      - build-mina-daemon-light
      - build-mina-archive
    with:
      profile: Mina Rosetta

  integration-tests-daemon:
    uses: ./.github/workflows/integration-tests-workflow.yaml
    needs:
      - build-mina-daemon-light
      - build-integration-tests-daemon
    with:
      profile: Mina Daemon

  integration-tests-archive:
    uses: ./.github/workflows/integration-tests-workflow.yaml
    needs:
      - build-mina-archive
      - build-integration-tests-archive
    with:
      profile: Mina Archive

  integration-tests-rosetta:
    uses: ./.github/workflows/integration-tests-workflow.yaml
    needs:
      - build-mina-rosetta
      - build-integration-tests-rosetta
    with:
      profile: Mina Rosetta
