# .github/workflows/lint-OCaml-check.yaml
---
name: OCaml Lints; Check-format, Require-ppx-version

on:
  workflow_call:
  push:
    branches: [28-analyze-dhall-files]

jobs:
  run-tests:
    runs-on: minafoundation-toolchain-jammy-runners
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          fetch-depth: 1
      - name: ğŸ§© Get opam dependency cache
        uses: actions/cache@v3.3.2
        id: opam_dependencies
        with:
          path: ~/.opam
          key: mina_opam_dependencies-${{ hashFiles('./opam.export') }}
      - name: ğŸ—ï¸ Build opam dependencies
        run: |
          opam switch import opam.export --quiet
          eval $(opam config env) \
          && ./scripts/pin-external-packages.sh \
          && opam clean --logs -cs --quiet

      - name: OCaml-check-change
        run: |
          echo "workspace ${{ github.workspace }}"
          ./buildkite/scripts/lint-check-format.sh && ./scripts/require-ppxs.py
